<!-- <%- include("./partials/header.ejs") %>
<%- include("./Paymentform.ejs") %> -->
    
<html lang="en">
    
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
        crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700" rel="stylesheet">
        <script src="https://hosted.paysafe.com/checkout/v2/paysafe.checkout.min.js"></script>
        <script src="https://code.jquery.com/jquery-1.6.2.min.js"></script>		

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Payment Form</title>
        
    </head>
    <body>  

        <div class="container mt-5">
          <div class="row">
            <div class="col"></div>
            <div class="col-sm-7 col-md-6 col-lg-5 ">
              <div class="card shadow border-0">
                <div class="card-body">
                  <h1 class="text-center">Paysafe Checkout</h1>
                  <p>
                    <small class="text-muted">Fields marked * are required.</small>
                  </p>
                  <form>
                    <div class="form-group" autocomplete="off">
                      <label for="">First Name*</label>
                      <input type="text" name="firstName" class="form-control" id="first_name" placeholder="John" autocomplete="off"  required>
                      <div class="invalid-feedback">
                        Please enter your first name.
                      </div>
                    </div>
      
                    <div class="form-group">
                      <label for="">Last Name*</label>
                      <input type="text" name="lastName" class="form-control" id="last_name" placeholder="Smith" autocomplete="off" required>
                      <div class="invalid-feedback">
                        Please enter your last name.
                      </div>
                    </div>
                    
                    <div class="form-group">
                      <label for="">Email*</label>
                      <input type="email" name="email" class="form-control" id="email" placeholder="john@smith.com" autocomplete="off" required>
                      <div class="invalid-feedback">
                        Please provide an email.
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="">Phone*</label>
                      <input type="number" name="phone" class="form-control" id="phone" placeholder="123-456-6789"autocomplete="off" required >
                    </div>
                    
                   
                    <div class="form-group">
                      <label for="">Amount*</label>
                      <input type="text"  class="form-control" id="amount" autocomplete="off" required>
                      <div class="invalid-feedback">
                        Please enter amount .
                      </div>
                    </div>
                    
                    <button name="submit" type="button" class="btn btn-danger btn-block" onclick="checkout()">Paid</button>
                  </form>
                  
                </div>
              </div>
            </div>
            <div class="col"> </div>
          </div>
        </div>
      
      
      
      </body>
      
      
      

    <script>
        async function checkout() {
            var firstName           = document.getElementById("first_name").value
            var lastName            = document.getElementById("last_name").value
            var email               = document.getElementById("email").value
            var number              =Math.floor(Math.random()*90000) + 10000
            var merchant_number     ="merchant"+number.toString()
            var amount              = document.getElementById("amount").value
            var phone               = document.getElementById("phone").value
            var singleUseCustomerToken;

            var data={
                email:email,
                firstName:firstName,
                LastName:lastName,
                merchantRefNum:merchant_number,
                amount:amount,
                phone:phone
            }

            // For customer id
            
            await $.ajax({
			    type: 'POST',
                data: data,
                dataType: "json",
                url: '/roiim/customeridloda',						
                success: function(data1) {
                    //console.log('ara')
                    //console.log(data1)
                    data.customerid=data1.id
                }
            });

            // for Single use customer token

            await $.ajax({
                type: 'POST',
                data : data,
                dataType: "json",
                url: '/roiim/customerToken',						
                success: function(data) {
                    //console.log('ara1')
                    //console.log(data.body.singleUseCustomerToken)
                    singleUseCustomerToken=data.body.singleUseCustomerToken
                    //console.log('loda'+singleUseCustomerToken)
                }
                        
            });

            //console.log('bc' + singleUseCustomerToken)

            // iframe
            

            var obj={
                "currency": "USD",
                "amount": parseInt(amount)*100,
                "locale": "en_US",
                "singleUseCustomerToken":singleUseCustomerToken,
                "customer": {
                    "firstName": firstName,
                    "lastName": lastName,
                    "email": email,
                    "phone": "1234567890",
                    "dateOfBirth": {
                        "day": 1,
                        "month": 7,
                        "year": 1990
                    }
                },
                "billingAddress": {
                    "nickName": firstName + " " + lastName,
                    "street": "20735 Stevens Creek Blvd",
                    "street2": "Montessori",
                    "city": "Cupertino",
                    "zip": "95014",
                    "country": "US",
                    "state": "CA"
                },
                "environment": "TEST",
                "merchantRefNum": merchant_number,
                "canEditAmount": true,
                "merchantDescriptor": {   
                    "dynamicDescriptor": "XYZ",
                    "phone": phone
                    },
                "displayPaymentMethods":["skrill","card"],
                "paymentMethodDetails": {
                    "paysafecard": {
                        "consumerId": "1232323"
                    },
                    "paysafecash": {
                        "consumerId": "123456"
                    },
                    "sightline": {
                        "consumerId": "123456",
                        "SSN": "123456789",
                        "last4ssn": "6789",
                        "accountId":"1009688222"
                    },
                    "vippreferred":{
                        "consumerId": "550726575",
                        "accountId":"1679688456"
                    }
                }
            }

            paysafe.checkout.setup("cHVibGljLTc3NTE6Qi1xYTItMC01ZjAzMWNiZS0wLTMwMmQwMjE1MDA4OTBlZjI2MjI5NjU2M2FjY2QxY2I0YWFiNzkwMzIzZDJmZDU3MGQzMDIxNDUxMGJjZGFjZGFhNGYwM2Y1OTQ3N2VlZjEzZjJhZjVhZDEzZTMwNDQ=",obj , function(instance, error, result) {
                
                if (result && result.paymentHandleToken) {
                    //console.log(result)
                    //console.log(result.paymentHandleToken);

                    var data={
                        token:result.paymentHandleToken,
                        merchantNumber:merchant_number,
                        amount:amount,
                    }

                    $.ajax({
						type: 'POST',
                        dataType : "json",
                        data : data,
                        url: '/roiim/payment',						
                        success: function(data) {
                            console.log('agya')
                            instance.showSuccessScreen()
                            setTimeout(function () { instance.close(); }, 6000);
                            setTimeout(function () { location.reload(); }, 2000);
                        },
                        error:function(){
                            instance.showFailureScreen()
                            setTimeout(function () { instance.close(); }, 6000);
                            setTimeout(function () { location.reload(); }, 2000);
                        }
                        
                    });
                }
                 else {
                    // Handle the error
                    console.log(error);
                    instance.showFailureScreen()
                }
            });
        }
    
    </script>
</html>
<!-- <%- include("./partials/footer.ejs") %> -->